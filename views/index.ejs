<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>申请机器</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="/applymachine/layui/css/layui.css" media="all" />
	<style type="text/css">
	table{
		border-collapse:collapse;
		color:#333333;
        border-width: 1px;
        border-color: #666666;
        font-size: 15px;
	}
	.tdclass{
		width: 130px;
		height: 40px;
		text-align: center;
		font-weight: bold;
	}
	.tdclass1{
		width: 150px;
		height: 40px;
		text-align: center;
	}
	table td {
		border-width: 1px;
		padding: 8px;
		border-style: solid;
		border-color: #666666;
		background-color: #ffffff;
	}
	#printcontent{
		padding:20px 80px;
	}
	.layui-form-label{
		width: 100px;
	}
	.layui-textarea{
		min-height: 15px;
	}
	</style>
</head>
<body>
<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
<!--[if lt IE 9]>
  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->    
<div class="layui-container">
	<div class="layui-row">
	    <div class="layui-col-12">
	      <img src="/applymachine/images/logo.jpg" style="max-height: 100px;">
	    </div>
	</div>
	<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    	<legend>公共计算平台申请表</legend>
    </fieldset>
    <a href="/applymachine/record" class="layui-btn layui-btn-xs" style="float: right;">记录查询</a>
	<form class="layui-form layui-row layui-col-space10">
		<div class="layui-col-md12 layui-col-xs12">

			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">申请人<span style="color: red;">*</span></label>
					<div class="layui-input-inline" style="width: 272px;">
				      <input type="text" name="applypeo" lay-verify="required" autocomplete="off" class="layui-input" id="applypeo">
				    </div>
				    <label class="layui-form-label">校园卡号<span style="color: red;">*</span></label>
					<div class="layui-input-inline" style="width: 272px;">
				      <input type="text" name="cardno" autocomplete="off" class="layui-input" id="cardno" lay-verify="required">
				    </div>
				</div>
			</div>

			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">学号(学生)</label>
					<div class="layui-input-inline" style="width: 272px;">
				      <input type="text" name="stuno" autocomplete="off" class="layui-input" id="stuno">
				    </div>
				    <label class="layui-form-label">所属研究所<span style="color: red;">*</span></label>
					<div class="layui-input-inline" style="width: 272px;">
				      <select name="research" id="research" lay-filter="research" lay-verify="required">
			              <option value="高性能计算研究所">高性能计算研究所</option>
			              <option value="大数据技术与应用研究所">大数据技术与应用研究所</option>
			              <option value="未来媒体技术与计算研究所">未来媒体技术与计算研究所</option>
			              <option value="网络与信息安全研究所">网络与信息安全研究所</option>
			              <option value="计算机视觉研究所">计算机视觉研究所</option>
			              <option value="物联网研究所">物联网研究所</option>
			              <option value="可视计算研究中心">可视计算研究中心</option>
			          </select>
				    </div>
				</div>
			</div>

			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">手机<span style="color: red;">*</span></label>
					<div class="layui-input-inline" style="width: 272px;">
				      <input type="text" name="phone"  autocomplete="off" class="layui-input" id="phone" lay-verify="phone">
				    </div>
				    <label class="layui-form-label">邮箱<span style="color: red;">*</span></label>
					<div class="layui-input-inline" style="width: 272px;">
				      <input type="text" name="email"  autocomplete="off" class="layui-input" id="email" lay-verify="email">
				    </div>
				</div>
			</div>

			<div class="layui-form-item" pane="">
			    <label class="layui-form-label">申请平台</label>
			    <div class="layui-input-inline" style="width: 272px;">
			    	<select name="platform" id="platform" lay-filter="platform" lay-verify="required">
			    		  <option value=""></option>
			              <option value="GPU加速虚拟机">GPU加速虚拟机</option>
			              <option value="GPU加速物理集群">GPU加速物理集群</option>
			              <option value="Kunlun9016小型机">Kunlun9016小型机</option>
			        </select>
			    </div>
			    <label class="layui-form-label">应用</label>
			    <div class="layui-input-inline" style="width: 272px;">
			    	<textarea id="useto" class="layui-textarea" disabled></textarea>
			    </div>
			</div>

			<div class="layui-form-item">
			    <label class="layui-form-label">预计使用时间</label>
			    <div class="layui-input-inline" style="width: 272px;">
			      <select name="usetime" lay-filter="usetime" lay-verify="required" id="usetime">
			        <option value="1个月">1个月</option>
			        <option value="3个月">3个月</option>
			        <option value="半年">半年</option>
			        <option value="半年">1年</option>
			      </select>
			    </div>
			  </div>

			<div class="layui-form-item">
			    <label class="layui-form-label">用途</label>
			    <div class="layui-input-inline" style="width: 272px;">
			      <select name="yongtu" id="yongtu" lay-filter="yongtu" lay-verify="required">
			      		<option value=""></option>
			              <option value="横向项目">横向项目</option>
			              <option value="纵向项目">纵向项目</option>
			              <option value="国家基金">国家基金</option>
			              <option value="省级基金">省级基金</option>
			              <option value="学习">学习</option>
			        </select>
			    </div>
			</div>

			<div class="layui-form-item">
			    <label class="layui-form-label infolabel"></label>
			    <div id="detail">
			    		
			    	    
			    </div>
			</div>

			<div class="layui-form-item">
				<div class="layui-col-md-offset1">
					<a class="layui-btn layui-btn-sm" lay-filter="update" lay-submit><i class="layui-icon">&#xe609;</i>确认</a>
					<a class="layui-btn layui-btn-sm" id="print"><i class="layui-icon">&#xe655;</i>打印</a>
				</div>
			</div>
		</div>
	</form>
	<div id="printcontent"></div>
	<hr class="layui-bg-gray" />
	<div class="layui-row">
	    <div class="layui-col-12">
	      <p style="text-align: center;">csse &copy; 2019</p>
	    </div>
	</div>
</div>
<script src="/applymachine/javascripts/jquery.min.js"></script>
<script type="text/javascript" src="/applymachine/layui/layui.js"></script>
<script src="/applymachine/javascripts/printThis.js"></script>

<!-- <script type="text/javascript" src="newsAdd.js"></script> -->
<script type="text/javascript">
//打印预览
        function Preview() {
            $("#printcontent").printThis({
                debug: false,
                importCSS: true,
                importStyle: true,
                printContainer: true,
                //loadCSS: "/Content/Themes/Default/style.css",
                pageTitle: "申请表",
                removeInline: false,
                printDelay: 333,
                header: null,
                formValues: true
            });
        };
layui.use(['jquery','layer','form'], function(){ 
    let $ = layui.$, //重点处
    	laydate = layui.laydate,
    	upload = layui.upload
    let form = layui.form,layer = layui.layer
    // layer.open({
    //   type: 2,
    //   title: '深圳大学计算机与软件学院公共计算平台服务管理办法（征求意见稿）',
    //   shadeClose: true,
    //   shade: false,
    //   closeBtn: 0, //不显示关闭按钮
    //   area: ['1000px', '650px'],
    //   content: '/applymachine/fangfa'
    // });

    //自定义验证规则
    $('#print').on('click',function(){
    	console.log('print',$('#printcontent'))
    	if($('#printcontent').children().length == 0){
    		console.log('没内容')
    		return 
    	}else{
    		Preview()
    	}
    })
    form.on('select(platform)',function(data){
    	console.log('platform select',data)
    	if(data.value=='GPU加速物理集群'){
    		$('#useto').val('进行性能测试、真实问题处理等用途')
    	}
    	if(data.value=='GPU加速虚拟机'){
    		$('#useto').val('用于进行程序设计、算法测试等用途的VMWare虚拟机')	
    	}
    	if(data.value=='Kunlun9016小型机'){
    		$('#useto').val('进行CPU/内存密集型程序设计、算法测试等用途')	
    	}
    	if(data.value==''){
    		$('#useto').val('')
    		layer.msg('请选择申请平台')
    		return false
    	}
    })
    form.on('select(yongtu)',function(data){
    	console.log('yongtu select',data)
    	if(data.value == ''){
    		if($('#detail').children().length!=0){
    			$('#detail').children().remove()
    		}
    		layer.msg('请选择申请平台')
    		return false
    	}
    	else if(data.value == '学习'){
    		if($('#detail').children().length!=0){
    			$('#detail').children().remove()
    		}
    		return false
    	}
    	else{
    		if($('#detail').children().length!=0){
    			$('#detail').children().remove()
    		}
    		let str = '<div class="layui-input-inline">' +
    				'<input type="text" placeholder="项目名称" class="layui-input" id="proname" lay-verify="required">' + '</div><div class="layui-input-inline">' +
    				'<input type="text" placeholder="负责人" class="layui-input" id="propeo" lay-verify="required">' +'</div>'
    		$('#detail').append(str)
    	}
    })
    form.on('submit(update)', function(data){
	  //更新
	  console.log('submit data',data)
	  
	  data.field.applypeo = $('#applypeo').val()
	  data.field.stuno = $('#stuno').val()
	  data.field.cardno = $('#cardno').val()
	  data.field.research = $('#research option:selected').val()
	  data.field.phone = $('#phone').val()
	  data.field.email = $('#email').val()
	  data.field.platform = $('#platform option:selected').val()
	  data.field.usetime = $('#usetime option:selected').val()
	  data.field.yongtu = $('#yongtu option:selected').val()
	  data.field.propeo = $('#propeo').val()
	  data.field.proname = $('#proname').val()

	  console.log('add  data field',data.field);

	  $.ajax({
	  	url:'/applymachine/saveapply',
	  	type:'POST',
	  	data:data.field,
	  	dataType : "json",
	  	success:function(result){
	  		if(result.code == 0){
	  			console.log('update success')
	  			//墨绿深蓝风
				layer.alert('申请成功，点击确定打印申请表', {
				  skin: 'layui-layer-molv' //样式类名
				  ,closeBtn: 0
				  ,end:function(){
				  	console.log('print')
				  	let html = '<p style="text-align:center;font-size:20px;font-weight:bold;margin-bottom:15px;">公共计算平台申请表</p><table><tr>' + 
				  				'<td class="tdclass">姓名</td><td class="tdclass1">' + data.field.applypeo + '</td><td class="tdclass">校园卡号</td><td class="tdclass1">' + data.field.cardno + '</td><td class="tdclass">学号(学生)</td><td class="tdclass1">' +
				  				data.field.stuno + '</td></tr><tr><td class="tdclass">研究所</td><td class="tdclass1">' + data.field.research + '</td><td class="tdclass">手机</td><td class="tdclass1">' + data.field.phone +
				  				'</td><td class="tdclass">邮箱</td><td class="tdclass1">' + data.field.email + '</td></tr><tr><td colspan="6">申请平台：' + data.field.platform + '</td></tr>'+
				  				'<tr><td colspan="6">用途：' + data.field.yongtu + ',' + data.field.proname + ',' + data.field.propeo + '</td></tr><tr><td colspan="6">预计使用时间：' + data.field.usetime +
				  				'</td></tr><tr><td colspan="6" style="height:150px;">导师意见(学生申请时填)：</td></tr><tr><td colspan="6" style="height:150px;"><p style="margin-right:150px;float:right;">本人(导师)签字：</p><p style="margin-right:150px;float:right;">日期</p></td></tr>'
				  	$('#printcontent').append(html)
				  	Preview()
				  }
				});	  			
	  		}
	  		if(result.code==-1){
	  			layer.msg(result.msg)
	  		}
	  	},
	  	error:function(msg){
	  		console.log('ajax error msg',msg)
	  	}
	  })
	});
})
</script>
</body>
</html>